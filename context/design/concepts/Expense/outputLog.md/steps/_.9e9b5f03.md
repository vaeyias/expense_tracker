---
timestamp: 'Tue Oct 14 2025 23:59:32 GMT-0400 (Eastern Daylight Time)'
parent: '[[..\20251014_235932.c17a38bf.md]]'
content_id: 9e9b5f032a94f49fc59474fb8b96e4d5c634d3f14ec930697cf849c0afa3bd21
---

# Relevant Code

```javascript
  /**
   * @requires expense exists, amountOwed>=0, user does not have a userSplit in the expense already
   * @effects adds a user split to the expense and returns its ID
   */
  async addUserSplit({
    expense,
    user,
    amountOwed,
  }: {
    expense: Expense;
    user: User;
    amountOwed: number;
  }): Promise<{ userSplit: UserSplit } | { error: string }> {
    if (amountOwed < 0) return { error: "amountOwed must be >= 0" };

    const expenseExists = await this.expenses.findOne({ _id: expense });
    if (!expenseExists) return { error: "Expense not found" };

    const existingSplit = this.userSplits.findOne({ expense: expense, user });
    if (!existingSplit) {
      PassThrough;
    } else {
      return { error: "User already has a split in this expense" };
    }

    const splitId = (await freshID()) as UserSplit;
    await this.userSplits.insertOne({
      _id: splitId,
      user,
      amountOwed,
      expense,
    });

    return { userSplit: splitId };
  }


```
